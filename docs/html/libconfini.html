<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.12"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libconfini: Library Functions Manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libconfini
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.12 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Library Functions Manual </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><dl class="section copyright"><dt>Copyright</dt><dd>GNU Public License v3</dd></dl>
<dl class="section date"><dt>Date</dt><dd>2016</dd></dl>
<h1>OVERVIEW</h1>
<p><b>libconfini</b> is a simple INI parsing library with the ability to read disabled entries (i.e., commented lines). <b>libconfini</b> does not store the data read from an INI file, but rather dispatches it, formatted, to a custom listener.</p>
<p>The code does not depend on any particular library, except for the C standard libraries <b>stdio.h</b> and <b>stdlib.h</b>.</p>
<p>If you want to start to learn directly from the code, you can find partially self-documented sample usages of <b>libconfini</b> under <code>/usr/share/doc/libconfini/examples/</code>.</p>
<h2>WHAT IS AN INI FILE</h2>
<p>INI files were introduced with the early versions of Microsoft Windows, where the .ini file name extension stood for INItialization. An INI file can be considered as a string representation of a tree object, with new lines used as delimiters between nodes. A typical INI file is a plain text file looking like the following example:</p>
<div class="fragment"><div class="line"># delivery.conf</div><div class="line"></div><div class="line">; general options</div><div class="line"></div><div class="line">location = Colosseum</div><div class="line">place = Rome</div><div class="line"></div><div class="line">[sender]</div><div class="line"></div><div class="line">name = John Smith</div><div class="line">email = john.smith@example.com</div><div class="line"></div><div class="line">[receiver]</div><div class="line"></div><div class="line">name = Mario Rossi      # He&#39;s a fat guy</div><div class="line">email = mario.rossi@example.com</div></div><!-- fragment --><h2>SUPPORTED SYNTAX</h2>
<p>During the years, several interpretations of INI files appeared. In some implementation the colon character (<code>:</code>) has been adopted as delimiter (a typical example under GNU/Linux is <code>/etc/nsswitch.conf</code>), in other implementation the space (<code>/[ \t\r\v\f]+/</code>) has been used instead (see for example <code>/etc/host.conf</code>), and so on. This library has been born as a general INI parser for GNU, so the support of most of the main <em>INI dialects</em> has been implemented within it.</p>
<p>Especially in Microsoft Windows, a more radical syntax variation has been implemented: the use of the semicolon, instead of new lines, as node delimiter, as in the following example:</p>
<div class="fragment"><div class="line"># delivery.conf</div><div class="line"></div><div class="line">; general options</div><div class="line"></div><div class="line">location = Colosseum; place = Rome; [sender] name = John Smith;</div><div class="line">email = john.smith@example.com; [receiver] name = Mario Rossi; # He&#39;s a fat guy</div><div class="line">email = mario.rossi@example.com</div></div><!-- fragment --><p>For several reasons the use of semicolon as node delimiter is not (and will never be) supported by <b>libconfini</b>.</p>
<h3>KEYS</h3>
<p>A <b>key element</b> is identified as a string followed by a delimiter &ndash; typically the equals sign (<code>=</code>) or the colon sign (<code>:</code>) or a space sequence (<code>/[ \t\v\f]+/</code>) &ndash; which is followed by a value, which is followed by a new line or an inline comment.</p>
<p>Both the <b>key part</b> and the <b>value part</b> may be enclosed within quotes (<code>'</code> or <code>"</code>):</p>
<div class="fragment"><div class="line">foo = &quot;bar&quot;</div><div class="line">&quot;hello&quot; = world</div><div class="line">&quot;artist&quot; = &quot;Pablo Picasso&quot;</div></div><!-- fragment --><p>In order to avoid error exceptions, strings containing an unterminated quote will always be treated as if they had a virtual quote as their last + 1 character.</p>
<div class="fragment"><div class="line">foo = &quot;bar</div></div><!-- fragment --><p>will always behave the same as if it were</p>
<div class="fragment"><div class="line">foo = &quot;bar&quot;</div></div><!-- fragment --><p>The <b>key part</b> can contain any character, except the delimiter (which can be enclosed within quotes for not beeing considered as such). The new line sequences (<code>\r</code>, <code>\n</code>, <code>\r\n</code>, <code>\n\r</code>) must be escaped.</p>
<p>If the <b>key part</b> part is missing the element is considered of unknown type (example: <code>= foo</code>). If the <b>value part</b> is missing the key element is considered empty (example: <code>foo =</code>). If the delimiter is missing the key can be considered an "implicit key", typically representing the boolean <code>TRUE</code> (example: <code>foo</code>). For instance, in the following example from <code>/etc/pacman.conf</code>, <code>IgnorePkg</code> is an empty key, while <code>Color</code> is an implicit key (representing a <code>TRUE</code> boolean &ndash; i.e., <code>Color = YES</code>):</p>
<div class="fragment"><div class="line">HoldPkg = pacman glibc</div><div class="line">Architecture = auto</div><div class="line">IgnorePkg =</div><div class="line">Color</div><div class="line">SigLevel = Required DatabaseOptional</div><div class="line">LocalFileSigLevel = Optional</div></div><!-- fragment --><p>The <b>value</b> part can contain typed data, usually: a boolean (booleans supported by <b>libconfini</b> are: <code>NO</code>/<code>YES</code>, <code>FALSE</code>/<code>TRUE</code>, <code>0</code>/<code>1</code>), a string, a number, or an array (typically with commas as members delimiters &ndash; example: <code>paths = /etc, /usr, "/home/john/Personal Data"</code>). The new line sequences (<code>\r</code>, <code>\n</code>, <code>\r\n</code>, <code>\n\r</code>) must be escaped.</p>
<p>In order to set the value to be assigned to implicit keys, please use the <code><a class="el" href="confini_8c.html#a0a3ba489c9ca7a9f25595b3945856113" title="Sets the valued used for implicit keys. ">ini_set_implicit_value()</a></code> function. A 'zero-length <code>TRUE</code>-boolean' is usually a good choice:</p>
<div class="fragment"><div class="line"><span class="comment">/* void ini_set_implicit_value (char * implicit_value, unsigned long int implicit_v_len); */</span></div><div class="line"></div><div class="line"><a class="code" href="confini_8c.html#a0a3ba489c9ca7a9f25595b3945856113">ini_set_implicit_value</a>(<span class="stringliteral">&quot;YES&quot;</span>, 0);</div></div><!-- fragment --><p>Alternatively, instead of <code><a class="el" href="confini_8c.html#a0a3ba489c9ca7a9f25595b3945856113" title="Sets the valued used for implicit keys. ">ini_set_implicit_value()</a></code> you can manually define at the beginning of your code the two global variables <code><a class="el" href="confini_8h.html#af8b0049b3a18c7704ad503ed6ad21927" title="Default value of implicit keys. ">INI_IMPLICIT_VALUE</a></code> and <code><a class="el" href="confini_8h.html#a0e1d42f056971f855c8130bc542d0ee9" title="Default length of implicit keys&#39; value â€“ it can be set to any unsigned number, independently of INI_...">INI_IMPLICIT_V_LEN</a></code>, which will be retrieved by <b>libconfini</b>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">char</span> *INI_IMPLICIT_VALUE = <span class="stringliteral">&quot;YES&quot;</span>;</div><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> INI_IMPLICIT_V_LEN = 3;</div></div><!-- fragment --><p>If not defined elsewhere, these variables are respectively set to <code>NULL</code> and <code>0</code> by default.</p>
<h3>SECTIONS</h3>
<p>A <b>section</b> can ben imagined like a directory. A <b>section path</b> is identified as the string <code>"$1"</code> in the regular expression (ECMAScript syntax) <code>/(?:^|\n)[ \t\v\f]*\[[ \t\v\f]*([^\]]*)[ \t\v\f]*\]/</code> globally applied to an INI file. A section path expresses nesting through the 'dot' character, as in the following example:</p>
<div class="fragment"><div class="line">[section]</div><div class="line"></div><div class="line">foo = bar</div><div class="line"></div><div class="line">[section.subsection]</div><div class="line"></div><div class="line">foo = bar</div></div><!-- fragment --><p>A section path starting with a dot expresses nesting to the previous section. Hence the last example is equivalent to:</p>
<div class="fragment"><div class="line">[section]</div><div class="line"></div><div class="line">foo = bar</div><div class="line"></div><div class="line">[.subsection]</div><div class="line"></div><div class="line">foo = bar</div></div><!-- fragment --><p>Keys appearing before any section path belong to a virtual <em>root</em> node, like the key <code>foo</code> in the following example:</p>
<div class="fragment"><div class="line">foo = bar</div><div class="line"></div><div class="line">[options]</div><div class="line"></div><div class="line">interval = 3600</div><div class="line"></div><div class="line">[host]</div><div class="line"></div><div class="line">address = 127.0.0.1</div><div class="line">port = 80</div></div><!-- fragment --><p>Section parts can be enclosed within quotes:</p>
<div class="fragment"><div class="line">[&quot;world&quot;.europe.&#39;germany&#39;.berlin]</div><div class="line"></div><div class="line">foo = bar</div></div><!-- fragment --><h3>COMMENTS</h3>
<p>Comments are string segments enclosed within the sequence <code>/\s+[;#]/</code> and a new line sequence, as in the following example:</p>
<div class="fragment"><div class="line"># this is a comment</div><div class="line"></div><div class="line">foo = bar       # this is an inline comment</div><div class="line"></div><div class="line">; this is another comment</div></div><!-- fragment --><h3>ESCAPING SEQUENCES</h3>
<p>For maximizing the flexibility of the data, only four escaping sequences are supported by <b>libconfini</b>: <code>\'</code>, <code>\"</code> <code>\\</code> and the multiline escaping sequence (ECMAScript syntax: <code>/\\(?:\n\r?|\r\n?)/</code>).</p>
<p>The first three escaping sequences are left untouched by all functions except <code><a class="el" href="confini_8c.html#ac4ae2df08ce4f4ffcb183d965ac4f35b" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are active) ...">ini_unquote()</a></code>. Nevertheless, the characters <code>'</code>, <code>"</code> and <code>\</code> can determine different behaviors during the parsing depending on whether they are escaped or unescaped. For instance, the string <code>#johnsmith</code> in the following example will not be parsed as a comment:</p>
<div class="fragment"><div class="line">[users.jsmith]</div><div class="line"></div><div class="line">comment = &quot;hey! have a look at my hashtag #johnsmith !&quot;</div></div><!-- fragment --><p>A particular case of escaping sequence is the multiline escaping sequence (<code>/\\(?:\n\r?|\r\n?)/</code>), which gets <em>always automatically unescaped by <b>libconfini</b></em>.</p>
<div class="fragment"><div class="line">foo = this\</div><div class="line">is\</div><div class="line">a\</div><div class="line">multiline\</div><div class="line">value</div></div><!-- fragment --><h3>ENCODINGS</h3>
<p>The encodings currently supported by <b>libconfini</b> are ASCII and UTF-8 (without BOM). In case the INI file is case-insensitive with respect to keys and section names, <b>libconfini</b> will always convert all ASCII letters to lowercase (except within values), including when these are enclosed within quotes, but will <b>not</b> convert non-ASCII code points to lowercase. <em>In general it is a good practice to use UTF-8 within values, but to use ASCII only within keys names and sections names.</em></p>
<h1>READ AN INI FILE</h1>
<p>The syntax of <b>libconfini</b>'s main function is:</p>
<div class="fragment"><div class="line"><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="confini_8c.html#a982a1152767d816df40568af90646bc9">load_ini_file</a> (</div><div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *path,</div><div class="line">    <a class="code" href="structIniFormat.html">IniFormat</a> format,</div><div class="line">    <span class="keywordtype">int</span> (*f_init)(</div><div class="line">        <a class="code" href="structIniStatistics.html">IniStatistics</a> *statistics,</div><div class="line">        <span class="keywordtype">void</span> *user_data</div><div class="line">    ),</div><div class="line">    <span class="keywordtype">int</span> (*f_foreach)(</div><div class="line">        <a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch,</div><div class="line">        <span class="keywordtype">void</span> *user_data</div><div class="line">    ),</div><div class="line">    <span class="keywordtype">void</span> *user_data</div><div class="line">)</div></div><!-- fragment --><p>where</p>
<ul>
<li><code>path</code> is the path where the INI file is located (pointer to a char array, a.k.a. a "C string")</li>
<li><code>format</code> is a bitfield structure defining the syntax of the INI file (see the <a class="el" href="structIniFormat.html">IniFormat</a> object)</li>
<li><code>f_init</code> is the function that will be invoked <em>before</em> any dispatching begins; it can be <code>NULL</code></li>
<li><code>f_foreach</code> is the callback function that will be invoked for each member of the INI file; it can be <code>NULL</code></li>
<li><code>user_data</code> is a pointer to a custom argument; it can be <code>NULL</code></li>
</ul>
<p>The function <code>f_init()</code> will be invoked with two arguments:</p>
<ul>
<li><code>statistics</code> &ndash; a pointer to a <a class="el" href="structIniStatistics.html">IniStatistics</a> object containing some properties about the file read (like its size in bytes and the number of its members)</li>
<li><code>user_data</code> &ndash; a pointer to the custom argument previously passed to the <code><a class="el" href="confini_8c.html#a982a1152767d816df40568af90646bc9" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> function</li>
</ul>
<p>The function <code>f_foreach()</code> will be invoked with two arguments:</p>
<ul>
<li><code>dispatch</code> &ndash; a pointer to a <a class="el" href="structIniDispatch.html">IniDispatch</a> object containing the parsed member of the INI file</li>
<li><code>user_data</code> &ndash; a pointer to the custom argument previously passed to the <code><a class="el" href="confini_8c.html#a982a1152767d816df40568af90646bc9" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> function</li>
</ul>
<h3>HOW IT WORKS</h3>
<p>The function <code><a class="el" href="confini_8c.html#a982a1152767d816df40568af90646bc9" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> dynamically allocates at once the whole INI file into the heap, and the two structures <code><a class="el" href="structIniStatistics.html" title="Global statistics about an INI file. ">IniStatistics</a></code> and <code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a></code> into the stack. All the members of the INI file are then dispatched to the listener <code>f_foreach()</code>. Finally the allocated memory gets automatically freed.</p>
<p>Because of this mechanism <em>it is very important the all the dispatched data be <b>immediately</b> copied by the user, if needed, and no pointers to the passed data be saved</em>: after the end of the <code><a class="el" href="confini_8c.html#a982a1152767d816df40568af90646bc9" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> function all the allocated data will be destroyed indeed.</p>
<p>Within a dispatching cycle, the structure containing each dispatch (<code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a> *dispatch</code>) is always the same <code>struct</code> that gets constantly updated with new information.</p>
<p>The strings passed with each dispatch must therefore not be freed. <em>Nevertheless, before being copied or analyzed they can be edited, <b>with some precautions</b></em>:</p>
<ol type="1">
<li>Be sure that your edit remains within the buffer lengths given (see: <code><a class="el" href="structIniDispatch.html#a34937218fa772fa66ceaa38923437791">IniDispatch::d_len</a></code> and <code><a class="el" href="structIniDispatch.html#a67b4c4b61e3c801cbfbcca95073ce864">IniDispatch::v_len</a></code>).</li>
<li>If you want to edit the content of <code><a class="el" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">IniDispatch::data</a></code> and this contains a section path, the <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> properties of its children <em>may</em> refer to the same buffer: if you edit it you can no more rely on its children's <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> properties (you will not make any damage, the loop will continue just fine: so if you think you are going to never use the property <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> just do it).</li>
<li>Regarding <code><a class="el" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">IniDispatch::value</a></code>, the buffer will not be shared between dispatches, so feel free to edit it.</li>
<li>Regarding <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code>, this buffer is likely to be shared with other dispatches: again, you will not destroy the world nor generate errors, but you will make the next <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code>s useless. Therefore, <b>the property <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> should be considered read-only</b> &ndash; this is just a logical imposition (and this is why <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> is not passed as <code>const</code>).</li>
</ol>
<p>Typical peaceful edits are the calls of the functions <code><a class="el" href="confini_8c.html#a744f00ac02b98c4a1f50206f0d28d9f8" title="Removes spaces around all the delimiters of a stringified array. ">ini_collapse_array()</a></code> and <code><a class="el" href="confini_8c.html#ac4ae2df08ce4f4ffcb183d965ac4f35b" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are active) ...">ini_unquote()</a></code> directly on the buffer <code><a class="el" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">IniDispatch::value</a></code> (but be sure that you are not going to edit the global string <code><a class="el" href="confini_8h.html#af8b0049b3a18c7704ad503ed6ad21927" title="Default value of implicit keys. ">INI_IMPLICIT_VALUE</a></code>):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch, <span class="keywordtype">void</span> *user_data) {</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (dispatch-&gt;<a class="code" href="structIniDispatch.html#a7f6ebc6713aae413c4157ce68008a8a8">type</a> == <a class="code" href="confini_8h.html#a4e394db479f56eaa830ade09c907461ba97333d01dfff8f9a9c690fc559751b45">INI_KEY</a> || dispatch-&gt;<a class="code" href="structIniDispatch.html#a7f6ebc6713aae413c4157ce68008a8a8">type</a> == <a class="code" href="confini_8h.html#a4e394db479f56eaa830ade09c907461ba9b68a1fa247c1b1ae3fc2ce615359c7b">INI_DISABLED_KEY</a>) {</div><div class="line"></div><div class="line">    <a class="code" href="confini_8c.html#ac4ae2df08ce4f4ffcb183d965ac4f35b">ini_unquote</a>(dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#adfda221d4a9effcb4f3ee6a99c5f2de2">format</a>);</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  printf(<span class="stringliteral">&quot;DATA: %s\nVALUE: %s\n&quot;</span>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">data</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#a982a1152767d816df40568af90646bc9">load_ini_file</a>(<span class="stringliteral">&quot;my_file.ini&quot;</span>, INI_DEFAULT_FORMAT, NULL, ini_listener, NULL)) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h3>SIZE OF THE DISPATCHED DATA</h3>
<p>Within an INI file it is granted that if one sums together all the properties <code><a class="el" href="structIniDispatch.html#a34937218fa772fa66ceaa38923437791">IniDispatch::d_len</a> + 1</code> and all the <em>non-zero</em> properties <code><a class="el" href="structIniDispatch.html#a67b4c4b61e3c801cbfbcca95073ce864">IniDispatch::v_len</a> + 1</code>, the result will always be less-than or equal-to <code><a class="el" href="structIniStatistics.html#ab5911ee36bf6c20d6e9107c769945ffd">IniStatistics::bytes</a></code> (where <code>+ 1</code> represents the NUL terminators). <b>If one adds to this also all the <code><a class="el" href="structIniDispatch.html#a12438a7f6cc343ad3202ffad82de671f">IniDispatch::at_len</a></code> properties, or if the <code><a class="el" href="structIniDispatch.html#a67b4c4b61e3c801cbfbcca95073ce864">IniDispatch::v_len</a></code> properties of implicit keys are non-zero, the sum may exceed it.</b> This can be relevant or irrelevant depending on your code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>size_check {</div><div class="line">  <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> bytes, buff_lengths;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_init (<a class="code" href="structIniStatistics.html">IniStatistics</a> *stats, <span class="keywordtype">void</span> *other) {</div><div class="line"></div><div class="line">  ((<span class="keyword">struct </span>size_check *) other)-&gt;bytes = stats-&gt;<a class="code" href="structIniStatistics.html#ab5911ee36bf6c20d6e9107c769945ffd">bytes</a>;</div><div class="line">  ((<span class="keyword">struct </span>size_check *) other)-&gt;buff_lengths = 0;</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *<span class="keyword">this</span>, <span class="keywordtype">void</span> *other) {</div><div class="line"></div><div class="line">  ((<span class="keyword">struct </span>size_check *) other)-&gt;buff_lengths += this-&gt;d_len + 1 + (this-&gt;v_len ? this-&gt;v_len + 1 : 0);</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  <span class="keyword">struct </span>size_check check;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#a982a1152767d816df40568af90646bc9">load_ini_file</a>(<span class="stringliteral">&quot;my_file.ini&quot;</span>, INI_DEFAULT_FORMAT, ini_init, ini_listener, &amp;check)) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  printf(</div><div class="line"></div><div class="line">    <span class="stringliteral">&quot;The file is %d bytes large.\n\nThe sum of the lengths of all &quot;</span></div><div class="line">    <span class="stringliteral">&quot;IniDispatch::data buffers plus the lengths of all non-empty &quot;</span></div><div class="line">    <span class="stringliteral">&quot;IniDispatch::value buffers is %d.\n&quot;</span>,</div><div class="line"></div><div class="line">    check.bytes, check.buff_lengths</div><div class="line"></div><div class="line">  );</div><div class="line"></div><div class="line">  <span class="comment">/* `INI_IMPLICIT_V_LEN` is 0 and is not even used, so this cannot happen: */</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (check.buff_lengths &gt; check.bytes) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;The end is near!&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h2>THE <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) â€“ sizeof(IniFormat) should...">IniFormat</a></code> BITFIELD</h2>
<p>For a correct use of this library it is fundamental to understand the <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) â€“ sizeof(IniFormat) should...">IniFormat</a></code> bitfield. <b>libconfini</b> has been born as a general INI parser, with the main purpose of <em>being able to understand INI files written by other programs</em> (see README). Therefore some flexibility was required.</p>
<p>When an INI file is parsed it is parsed according to a format. The <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) â€“ sizeof(IniFormat) should...">IniFormat</a></code> bitfield is a description of such format.</p>
<p>Each format can be represented also as a univocal 24-bit unsigned integer. For converting an <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) â€“ sizeof(IniFormat) should...">IniFormat</a></code> to a number and vice versa please see <code><a class="el" href="confini_8c.html#a9a64f92daee918044788b1d221c68631" title="Converts an IniFormat into an IniFormatId. ">ini_format_get_id()</a></code>, <code><a class="el" href="confini_8c.html#a70efd63125e671c52dc998341b4609db" title="Sets all the values of an IniFormat by reading them from an IniFormatId. ">ini_format_set_to_id()</a></code> and <code><a class="el" href="confini_8h.html#ad88dd5ea6ac66d7b1c31c5e26fca8e88" title="24-bit bitmask representing the format of an INI file ">IniFormatId</a></code>.</p>
<h3>THE MODEL FORMAT</h3>
<p>A model format named <code>INI_DEFAULT_FORMAT</code> is also available.</p>
<div class="fragment"><div class="line"><a class="code" href="structIniFormat.html">IniFormat</a> my_format;</div><div class="line"></div><div class="line">my_format = INI_DEFAULT_FORMAT;</div></div><!-- fragment --><p>The code above corresponds to:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define NO 0</span></div><div class="line"><span class="preprocessor">#define YES 1</span></div><div class="line"></div><div class="line"><a class="code" href="structIniFormat.html">IniFormat</a> my_format;</div><div class="line"></div><div class="line">my_format.<a class="code" href="structIniFormat.html#a6d9981301f5a16d73e2c38cb80f7f962">delimiter_symbol</a> = <a class="code" href="confini_8h.html#ad342637c37d95454c9392a8cc73bced8a4f659344801c97d2fe59fd49bea2351f">INI_EQUALS</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a90f42c0052d9a45ad137f2f5517fbb3c">semicolon</a> = <a class="code" href="confini_8h.html#a397bfc55d3cf3e2ecd6b044e4d168796a01dfea6f7d0d7c409086448bf31d5218">INI_PARSE_COMMENT</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a8bcb597ed6feba60112a8467bdb4bfd7">hash</a> = <a class="code" href="confini_8h.html#a397bfc55d3cf3e2ecd6b044e4d168796a01dfea6f7d0d7c409086448bf31d5218">INI_PARSE_COMMENT</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a5bdf0e00657ad5521a027e454ec2298e">multiline_entries</a> = <a class="code" href="confini_8h.html#ac670c2fdf19ae6eee3de83dd183ae55fa17e1a311cef9d9ea4175de00a8e5f5f2">INI_EVERYTHING_MULTILINE</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a50f562eda0d26ed7e0d3c57afeb46d2d">case_sensitive</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a491e94bda3f8545471a86f0845c92474">no_spaces_in_names</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a2fe0e57e8a802f828bc12a6462438e38">no_single_quotes</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#aa6e8b4274f3da1468a1806398b504d64">no_double_quotes</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#ae5722efd535f1d27c624a927eea622c3">implicit_is_not_empty</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#af411935de86436fb9555ee57ba04960e">do_not_collapse_values</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a40a08a472ae9053fbaf4e7042967503d">no_disabled_after_space</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#ab5937aaf72b0ce5b62aece8d23ad7b82">disabled_can_be_implicit</a> = NO; </div></div><!-- fragment --><h2>THE <code><a class="el" href="structIniStatistics.html" title="Global statistics about an INI file. ">IniStatistics</a></code> AND <code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a></code> STRUCTURES</h2>
<p>When the <code><a class="el" href="confini_8c.html#a982a1152767d816df40568af90646bc9" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> function reads an INI file, it dispatches the file content to the <code>f_foreach()</code> listener. Before the dispatching begins some statistics about the parsed file can be dispatched to the <code>f_init()</code> listener (if this is non-<code>NULL</code>).</p>
<p>The information passed to <code>f_init()</code> is passed through an <code><a class="el" href="structIniStatistics.html" title="Global statistics about an INI file. ">IniStatistics</a></code> structure, while the information passed to <code>f_foreach()</code> is passed through an <code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a></code> structure.</p>
<h2>FORMATTING THE VALUES</h2>
<p>Once your listener starts to receive the parsed data you may want to parse and better format the <code>value</code> part of key elements. The following functions may be useful for this purpose:</p>
<ul>
<li><code><a class="el" href="confini_8c.html#ac4ae2df08ce4f4ffcb183d965ac4f35b" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are active) ...">ini_unquote()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a7906f6324aa01202145d1c98591310d2" title="Gets the length of an INI array. ">ini_array_get_length()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a744f00ac02b98c4a1f50206f0d28d9f8" title="Removes spaces around all the delimiters of a stringified array. ">ini_collapse_array()</a></code></li>
<li><code><a class="el" href="confini_8c.html#afc314ee1133ce9710ec6d6cc6e684a71" title="Calls a custom function for each member of an INI array â€“ useful for read-only (const) stringified a...">ini_array_foreach()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a5fb5875b30fc361127a6d95898a7ed60" title="Splits an INI array and calls a custom function for each member. ">ini_split_array()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a2a8dcc3d8ff26554486691423cce4ea0" title="Checks whether a string matches exactly one of the booleans listed in the private constant _LIBCONFIN...">ini_get_bool()</a></code></li>
<li><code><a class="el" href="confini_8c.html#ad95262d09842c25e8bb610bf95c42cd3" title="Checks whether the first letter of a string matches the first letter of one of the booleans listed in...">ini_get_lazy_bool()</a></code></li>
</ul>
<p>Together with the functions listed above the following wrappers are available, in case you don't want to <code>#include &lt;stdlib.h&gt;</code> in your source:</p>
<ul>
<li><code><a class="el" href="confini_8c.html#a5b6bebfc01f8b23f69a2a2e602e91521">ini_get_int()</a></code> = <code>atoi()</code></li>
<li><code><a class="el" href="confini_8c.html#a05042d2551ab1c9402ab7223547c0777">ini_get_lint()</a></code> = <code>atol()</code></li>
<li><code><a class="el" href="confini_8c.html#aaf3640e3632b10bf8dd2e852a7d82630">ini_get_llint()</a></code> = <code>atoll()</code></li>
<li><code><a class="el" href="confini_8c.html#a178704d02ede6101f757bbd37e5bd697">ini_get_float()</a></code> = <code>atof()</code></li>
</ul>
<h2>FORMATTING THE KEY NAMES</h2>
<p>The function <code><a class="el" href="confini_8c.html#ac4ae2df08ce4f4ffcb183d965ac4f35b" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are active) ...">ini_unquote()</a></code> may be useful for key names enclosed within quotes.</p>
<h2>FORMATTING THE SECTION PATHS</h2>
<p>For retrieving the parts of a section path the functions <code><a class="el" href="confini_8c.html#a7906f6324aa01202145d1c98591310d2" title="Gets the length of an INI array. ">ini_array_get_length()</a></code>, <code><a class="el" href="confini_8c.html#afc314ee1133ce9710ec6d6cc6e684a71" title="Calls a custom function for each member of an INI array â€“ useful for read-only (const) stringified a...">ini_array_foreach()</a></code> and <code><a class="el" href="confini_8c.html#a5fb5875b30fc361127a6d95898a7ed60" title="Splits an INI array and calls a custom function for each member. ">ini_split_array()</a></code> can be used with '.' as delimiter. Note that section paths dispatched by <b>libconfini</b> are <em>always</em> collapsed arrays, therefore calling the function <code><a class="el" href="confini_8c.html#a744f00ac02b98c4a1f50206f0d28d9f8" title="Removes spaces around all the delimiters of a stringified array. ">ini_collapse_array()</a></code> on them will have no effects.</p>
<p>It may be required that the function <code><a class="el" href="confini_8c.html#ac4ae2df08ce4f4ffcb183d965ac4f35b" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are active) ...">ini_unquote()</a></code> be applied to each part of a section path, depending on the content and the format of the INI file. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.12
</small></address>
</body>
</html>
