<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libconfini: Library Functions Manual</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libconfini
   </div>
   <div id="projectbrief">Yet another INI parser</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Library Functions Manual </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Yet another INI parser</p>
<dl class="section copyright"><dt>Copyright</dt><dd>GNU Public License v3</dd></dl>
<h2>DESCRIPTION</h2>
<p><b>libconfini</b> is a simple INI parsing library with the ability to read disabled entries (i.e., valid entries nested in comments). <b>libconfini</b> does not store the data read from an INI file, but rather dispatches it, formatted, to a custom listener.</p>
<p>The code is written in C and does not depend on any particular library, except for the C standard libraries <b>stdio.h</b>, <b>stdlib.h</b> and <b>stdint.h</b>.</p>
<p>If you want to start to learn directly from the code, you can find partially self-documented sample usages of <b>libconfini</b> under <code>/usr/share/doc/libconfini/examples/</code>.</p>
<h2>WHAT IS AN INI FILE</h2>
<p>INI files were introduced with the early versions of Microsoft Windows, where the .ini file name extension stood for INItialization. An INI file can be considered as a string representation of a tree object, with new lines used as delimiters between nodes. A typical INI file is a plain text file looking like the following example:</p>
<div class="fragment"><div class="line"># delivery.conf</div><div class="line"></div><div class="line">; general options</div><div class="line"></div><div class="line">location = Colosseum</div><div class="line">place = Rome</div><div class="line"></div><div class="line">[sender]</div><div class="line"></div><div class="line">name = John Smith</div><div class="line">email = john.smith@example.com</div><div class="line"></div><div class="line">[receiver]</div><div class="line"></div><div class="line">name = Mario Rossi   # He&#39;s a fat guy</div><div class="line">email = mario.rossi@example.com</div></div><!-- fragment --><h2>SUPPORTED SYNTAXES</h2>
<p>During the years, several interpretations of INI files appeared. In some implementations the colon character (<code>:</code>) has been adopted as delimiter between keys and values (a typical example under GNU/Linux is <code>/etc/nsswitch.conf</code>), in other implementations the space (<code>/[ \t\v\f]+/</code> or <code>/(?:\\(?:\n\r?|\r\n?)|[\t \v\f])+/</code>) has been used instead (see for example <code>/etc/host.conf</code>), and so on. This library has been born as a general INI parser for GNU, so the support of most of the main INI dialects has been implemented within it.</p>
<p>Especially in Microsoft Windows a more radical syntax variation has been implemented: the use of the semicolon, instead of new lines, as delimiter between nodes, as in the following example:</p>
<div class="fragment"><div class="line"># delivery.conf</div><div class="line"></div><div class="line">; general options</div><div class="line"></div><div class="line">location = Colosseum; place = Rome; [sender] name = John Smith;</div><div class="line">email = john.smith@example.com; [receiver] name = Mario Rossi; # He&#39;s a fat guy</div><div class="line">email = mario.rossi@example.com</div></div><!-- fragment --><p>For several reasons the use of semicolon as node delimiter is not (and will never be) supported by <b>libconfini</b>.</p>
<h3>KEYS</h3>
<p>A <b>key element</b> is identified as a string followed by a delimiter &ndash; typically the equals sign (<code>=</code>) or the colon sign (<code>:</code>) or a space sequence (<code>/\s+/</code>) &ndash; which is followed by a value, which is followed by a new line or an inline comment.</p>
<p>Both the <b>key part</b> and the <b>value part</b> may be enclosed within quotes (<code>'</code> or <code>"</code>):</p>
<div class="fragment"><div class="line">foo = &#39;bar&#39;</div><div class="line">&quot;hello&quot; = world</div><div class="line">&quot;artist&quot; = &quot;Pablo Picasso&quot;</div></div><!-- fragment --><p>The <b>key part</b> can contain any character, except the delimiter (which may be enclosed within quotes for not beeing considered as such). In multiline formats internal new line sequences must be escaped (<code>/\\(?:\n\r?|\r\n?)/</code>).</p>
<p>If the <b>key part</b> part is missing the element is considered of unknown type, i.e., <code>INI_UNKNOWN</code> &ndash; see <code>enum</code> <code><a class="el" href="confini_8h.html#a4e394db479f56eaa830ade09c907461b" title="INI nodes types. ">IniNodeType</a></code> &ndash; (example: <code>= foo</code>). If the <b>value part</b> is missing the key element is considered empty (example: <code>foo =</code>). If the delimiter is missing, according to some formats the key element is considered to be an <em>implicit key</em> &ndash; typically representing the boolean <code>TRUE</code> (example: <code>foo</code>). For instance, in the following example from <code>/etc/pacman.conf</code>, <code>IgnorePkg</code> is an empty key, while <code>Color</code> is an implicit key (representing a <code>TRUE</code> boolean &ndash; i.e., <code>Color = YES</code>):</p>
<div class="fragment"><div class="line">HoldPkg = pacman glibc</div><div class="line">Architecture = auto</div><div class="line">IgnorePkg =</div><div class="line">Color</div><div class="line">SigLevel = Required DatabaseOptional</div><div class="line">LocalFileSigLevel = Optional</div></div><!-- fragment --><p>The <b>value</b> part can contain typed data, usually: a boolean (booleans supported by <b>libconfini</b> are: <code>NO</code>/<code>YES</code>, <code>FALSE</code>/<code>TRUE</code>, <code>0</code>/<code>1</code>), a string, a number, or an array (typically with commas as delimiters between members &ndash; example: <code>paths = /etc, /usr, "/home/john/Personal Data"</code>). In multiline formats internal new line sequences must be escaped (<code>/\\(?:\n\r?|\r\n?)/</code>).</p>
<div class="fragment"><div class="line">[my_section]</div><div class="line"></div><div class="line">my_string = &quot;Hello world&quot;</div><div class="line">&#39;my_number&#39; = 42</div><div class="line">my_boolean = NO</div><div class="line">my_implicit_boolean</div><div class="line">my_array = Asia, Africa, &#39;North America&#39;, South America,\</div><div class="line">           Antarctica, Europe, Australia</div></div><!-- fragment --><h3>SECTIONS</h3>
<p>A <b>section</b> may be imagined like a directory. A <b>section path</b> is identified as the string <code>"$1"</code> in the regular expression <code>/(?:^|\n)[ \t\v\f]*\[[ \t\v\f]*([^\]]*)[ \t\v\f]*\]/</code> globally applied to an INI file. A section path expresses nesting through the “dot” character, as in the following example:</p>
<div class="fragment"><div class="line">[section]</div><div class="line"></div><div class="line">foo = bar</div><div class="line"></div><div class="line">[section.subsection]</div><div class="line"></div><div class="line">foo = bar</div></div><!-- fragment --><p>A section path starting with a dot expresses nesting to the previous section. Hence the last example is equivalent to:</p>
<div class="fragment"><div class="line">[section]</div><div class="line"></div><div class="line">foo = bar</div><div class="line"></div><div class="line">[.subsection]</div><div class="line"></div><div class="line">foo = bar</div></div><!-- fragment --><p>Keys appearing before any section path belong to a virtual <em>root</em> node (with an empty string as path), as the key <code>foo</code> in the following example:</p>
<div class="fragment"><div class="line">foo = bar</div><div class="line"></div><div class="line">[options]</div><div class="line"></div><div class="line">interval = 3600</div><div class="line"></div><div class="line">[host]</div><div class="line"></div><div class="line">address = 127.0.0.1</div><div class="line">port = 80</div></div><!-- fragment --><p>Section parts may be enclosed within quotes:</p>
<div class="fragment"><div class="line">[&quot;world&quot;.europe.&#39;germany&#39;.berlin]</div><div class="line"></div><div class="line">foo = bar</div></div><!-- fragment --><h3>COMMENTS</h3>
<p>Comments are string segments enclosed within the sequence <code>/(?:^|\s)[;#]/</code> and a new line sequence, as in the following example:</p>
<div class="fragment"><div class="line"># this is a comment</div><div class="line"></div><div class="line">foo = bar       # this is an inline comment</div><div class="line"></div><div class="line">; this is another comment</div></div><!-- fragment --><p>Comments may in theory be multiline, following the same syntax of multiline disabled entries (see below). This is usually of little utility, except for inline comments that you want to make sure will refer to the previous entry:</p>
<div class="fragment"><div class="line">comedy1 = The Tempest</div><div class="line"></div><div class="line">comedy2 = Twelfth Night  # If music be the food of love, play on;      \</div><div class="line">                         # Give me excess of it; that, surfeiting,     \</div><div class="line">                         # The appetite may sicken, and so die.        \</div><div class="line">                         # That strain again; it had a dying fall:     \</div><div class="line">                         # O, it came oer my ear, like the sweet sound \</div><div class="line">                         # That breathes upon a bank of violets,       \</div><div class="line">                         # Stealing, and giving odour! Enough! No more.\</div><div class="line">                         # &#39;Tis not so sweet now as it was before.     \</div><div class="line">                         #                                             \</div><div class="line">                         #     Orsino, scene I</div><div class="line"></div><div class="line"># This is also a masterpiece!</div><div class="line">comedy3 = The Merchant of Venice</div></div><!-- fragment --><h3>ESCAPING SEQUENCES</h3>
<p>In order to maximize the flexibility of the data, only four escaping sequences are supported by <b>libconfini</b>: <code>\'</code>, <code>\&quot;</code>, <code>\\</code> and the multiline escaping sequence (<code>/\\(?:\n\r?|\r\n?)/</code>).</p>
<p>The first three escaping sequences are left untouched by all functions except <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>. Nevertheless, the characters <code>'</code>, <code>"</code> and <code>\</code> can determine different behaviors during the parsing, depending on whether they are escaped or unescaped. For instance, the string <code>johnsmith !&quot;</code> in the following example will not be parsed as a comment:</p>
<div class="fragment"><div class="line">[users.jsmith]</div><div class="line"></div><div class="line">comment = &quot;hey! have a look at my hashtag #johnsmith !&quot;</div></div><!-- fragment --><p>A particular case of escaping sequence is the multiline escaping sequence (<code>/\\(?:\n\r?|\r\n?)/</code>), which in multiline INI files gets <em>immediately unescaped by <b>libconfini</b></em>.</p>
<div class="fragment"><div class="line">foo = this\</div><div class="line">is\</div><div class="line">a\</div><div class="line">multiline\</div><div class="line">value</div></div><!-- fragment --><h3>DISABLED ENTRIES</h3>
<p>A disabled entry is either a section or a key that has been nested inside a comment as its only child. Inline comments cannot represent disabled entries. According to some formats disabled entries can be multiline, using <code>/\\(?:\n\r?|\r\n?)[\t \v\f]*[;#]+/</code> as multiline escaping sequence. For example:</p>
<div class="fragment"><div class="line">#this = is\</div><div class="line"> #a\</div><div class="line">    #multiline\</div><div class="line">#disabled\</div><div class="line">  #entry</div></div><!-- fragment --><h2>READ AN INI FILE</h2>
<p>The syntax of <b>libconfini</b>'s parsing functions is:</p>
<p>#1 (using a pointer to a <code>FILE</code> structure)</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="confini_8c.html#a90987f4565566e21693b90239663618d">load_ini_file</a> (</div><div class="line">    FILE * ini_file,</div><div class="line">    <a class="code" href="structIniFormat.html">IniFormat</a> format,</div><div class="line">    <span class="keywordtype">int</span> (*f_init)(</div><div class="line">        <a class="code" href="structIniStatistics.html">IniStatistics</a> *statistics,</div><div class="line">        <span class="keywordtype">void</span> *user_data</div><div class="line">    ),</div><div class="line">    <span class="keywordtype">int</span> (*f_foreach)(</div><div class="line">        <a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch,</div><div class="line">        <span class="keywordtype">void</span> *user_data</div><div class="line">    ),</div><div class="line">    <span class="keywordtype">void</span> *user_data</div><div class="line">)</div></div><!-- fragment --><p>#2 (using a path)</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> <a class="code" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946">load_ini_path</a> (</div><div class="line">    <span class="keywordtype">char</span> *path,</div><div class="line">    <a class="code" href="structIniFormat.html">IniFormat</a> format,</div><div class="line">    <span class="keywordtype">int</span> (*f_init)(</div><div class="line">        <a class="code" href="structIniStatistics.html">IniStatistics</a> *statistics,</div><div class="line">        <span class="keywordtype">void</span> *user_data</div><div class="line">    ),</div><div class="line">    <span class="keywordtype">int</span> (*f_foreach)(</div><div class="line">        <a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch,</div><div class="line">        <span class="keywordtype">void</span> *user_data</div><div class="line">    ),</div><div class="line">    <span class="keywordtype">void</span> *user_data</div><div class="line">)</div></div><!-- fragment --><p>where</p>
<ul>
<li><code>ini_file</code> in <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> is the <code>FILE</code> struct pointing to the INI file</li>
<li><code>path</code> in <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> is the path where the INI file is located (pointer to a char array, a.k.a. a "C string")</li>
<li><code>format</code> is a bitfield structure defining the syntax of the INI file (see the <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) – sizeof(IniFormat) should...">IniFormat</a></code> struct)</li>
<li><code>f_init</code> is the function that will be invoked <em>before</em> any dispatching begins &ndash; it can be <code>NULL</code></li>
<li><code>f_foreach</code> is the callback function that will be repeatedly invoked for each member of the INI file - it can be <code>NULL</code></li>
<li><code>user_data</code> is a pointer to a custom argument &ndash; it can be <code>NULL</code></li>
</ul>
<p>The function <code>f_init()</code> is invoked with two arguments:</p>
<ul>
<li><code>statistics</code> &ndash; a pointer to an <code><a class="el" href="structIniStatistics.html" title="Global statistics about an INI file. ">IniStatistics</a></code> object containing some properties about the file read (like its size in bytes and the number of its members)</li>
<li><code>user_data</code> &ndash; a pointer to the custom argument previously passed to the <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> / <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> functions</li>
</ul>
<p>The function <code>f_foreach()</code> is invoked with two arguments:</p>
<ul>
<li><code>dispatch</code> &ndash; a pointer to an <code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a></code> object containing the parsed member of the INI file</li>
<li><code>user_data</code> &ndash; a pointer to the custom argument previously passed to the <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> / <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> functions</li>
</ul>
<p>Both functions <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> and <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> return zero if the INI file has been completely parsed, non-zero otherwise.</p>
<h2>BASIC EXAMPLES</h2>
<p>#1</p>
<div class="fragment"><div class="line"><span class="comment">/* examples/topics/load_ini_file.c */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch, <span class="keywordtype">void</span> *v_null) {</div><div class="line"></div><div class="line">  printf(</div><div class="line">    <span class="stringliteral">&quot;DATA: %s\nVALUE: %s\nNODE TYPE: %d\n\n&quot;</span>,</div><div class="line">    dispatch-&gt;<a class="code" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">data</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a7f6ebc6713aae413c4157ce68008a8a8">type</a></div><div class="line">  );</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  FILE * <span class="keyword">const</span> ini_file = fopen(<span class="stringliteral">&quot;example.conf&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (ini_file == NULL) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;File doesn&#39;t exist :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#a90987f4565566e21693b90239663618d">load_ini_file</a>(ini_file, INI_DEFAULT_FORMAT, NULL, ini_listener, NULL)) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  fclose(ini_file);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>#2</p>
<div class="fragment"><div class="line"><span class="comment">/* examples/topics/load_ini_path.c */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch, <span class="keywordtype">void</span> *v_null) {</div><div class="line"></div><div class="line">  printf(</div><div class="line">    <span class="stringliteral">&quot;DATA: %s\nVALUE: %s\nNODE TYPE: %d\n\n&quot;</span>,</div><div class="line">    dispatch-&gt;<a class="code" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">data</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a7f6ebc6713aae413c4157ce68008a8a8">type</a></div><div class="line">  );</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946">load_ini_path</a>(<span class="stringliteral">&quot;example.conf&quot;</span>, INI_DEFAULT_FORMAT, NULL, ini_listener, NULL)) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h2>HOW IT WORKS</h2>
<p>The function <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> is a shortcut to the function <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> using a path instead of a <code>FILE</code> struct.</p>
<p>The function <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> dynamically allocates at once the whole INI file into the heap, and the two structures <code><a class="el" href="structIniStatistics.html" title="Global statistics about an INI file. ">IniStatistics</a></code> and <code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a></code> into the stack. All the members of the INI file are then dispatched to the custom listener <code>f_foreach()</code>. Finally the allocated memory gets automatically freed.</p>
<p>Because of this mechanism <em>it is very important that all the dispatched data be <b>immediately</b> copied by the user (when needed), and no pointers to the passed data be saved</em>: after the end of the functions <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> / <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> all the allocated data will be destroyed indeed.</p>
<p>Within a dispatching cycle, the structure containing each dispatch (<code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a> *dispatch</code>) is always the same <code>struct</code> that gets constantly updated with new information.</p>
<h2>RENDERING</h2>
<p>The output strings dispatched by <b>libconfini</b> will follow some formatting rules depending on their role within the INI file. First, the multiline sequences will be unescaped, then</p>
<ul>
<li><b>Section paths</b> will be rendered according to ECMAScript <code>section_name.replace(/\.*\s*$|(?:\s*(\.))+\s*|^\s+/g, "$1").replace(/\s+/g, " ")</code> &ndash; within single or double quotes, if active, the text will be rendered verbatim</li>
<li><b>Key names</b> will be rendered according to ECMAScript <code>key_name.replace(/^[\n\r]\s*|\s+/g, " ")</code> &ndash; within single or double quotes, if active, the text will be rendered verbatim</li>
<li><b>Values</b>, if <code>format.do_not_collapse_values</code> is active, will only be cleaned of spaces at the beginning and at the end, otherwise will be rendered though the same algorithm used for key names.</li>
<li><b>Comments</b>: if multiline, ECMAScript <code>comment_string.replace(/(^|\n\r?|\r\n?)[ \t\v\f]*[#;]+/g, "$1")</code>; otherwise, ECMAScript <code>comment_string.replace(/^[ \t\v\f]*[#;]+/, "")</code>.</li>
<li><b>Unknown nodes</b> will be rendered verbatim.</li>
</ul>
<p>The strings passed with each dispatch, as already said, must not be freed. <em>Nevertheless, before being copied or analyzed they can be edited, <b>with some precautions</b></em>:</p>
<ol type="1">
<li>Be sure that your edit remains within the buffer lengths given (see: <code><a class="el" href="structIniDispatch.html#a34937218fa772fa66ceaa38923437791">IniDispatch::d_len</a></code> and <code><a class="el" href="structIniDispatch.html#a67b4c4b61e3c801cbfbcca95073ce864">IniDispatch::v_len</a></code>).</li>
<li>If you want to edit the content of <code><a class="el" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">IniDispatch::data</a></code> and this contains a section path, the <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> properties of its children <em>may</em> refer to the same buffer: if you edit it you can no more rely on its children's <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> properties (you will not make any damage, the loop will continue just fine: so if you think you are going to never use the property <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> just do it).</li>
<li>Regarding <code><a class="el" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">IniDispatch::value</a></code>, the buffer is never shared between dispatches, so feel free to edit it.</li>
<li>Regarding <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code>, this buffer is likely to be shared with other dispatches: again, you will not destroy the world nor generate errors, but you will make the next <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code>s useless. Therefore <b>the property <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> should be considered read-only</b> &ndash; this is just a logical imposition (and this is why <code><a class="el" href="structIniDispatch.html#ae3aca4d49e430c9180b4f80b3f0624d9">IniDispatch::append_to</a></code> is not passed as <code>const</code>).</li>
</ol>
<p>Typical peaceful edits are the calls of the functions <code><a class="el" href="confini_8c.html#a74789309b1a9c5b8886484c2b4d3a381" title="Compresses the distribution of the data of an INI array by removing all the white spaces that sorroun...">ini_collapse_array()</a></code> and <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code> directly on the buffer <code><a class="el" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">IniDispatch::value</a></code> &ndash; but make sure that you are not going to edit the global string <code><a class="el" href="confini_8h.html#af8b0049b3a18c7704ad503ed6ad21927" title="Value to be dispatched in case of implicit keys (default value: NULL) ">INI_IMPLICIT_VALUE</a></code>, if used (see below):</p>
<div class="fragment"><div class="line"><span class="comment">/* examples/topics/ini_unquote.c */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch, <span class="keywordtype">void</span> *v_null) {</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (dispatch-&gt;<a class="code" href="structIniDispatch.html#a7f6ebc6713aae413c4157ce68008a8a8">type</a> == <a class="code" href="confini_8h.html#a4e394db479f56eaa830ade09c907461ba97333d01dfff8f9a9c690fc559751b45">INI_KEY</a> || dispatch-&gt;<a class="code" href="structIniDispatch.html#a7f6ebc6713aae413c4157ce68008a8a8">type</a> == <a class="code" href="confini_8h.html#a4e394db479f56eaa830ade09c907461ba9b68a1fa247c1b1ae3fc2ce615359c7b">INI_DISABLED_KEY</a>) {</div><div class="line"></div><div class="line">    <a class="code" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11">ini_unquote</a>(dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#adfda221d4a9effcb4f3ee6a99c5f2de2">format</a>);</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  printf(<span class="stringliteral">&quot;DATA: %s\nVALUE: %s\n&quot;</span>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">data</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946">load_ini_path</a>(<span class="stringliteral">&quot;example.conf&quot;</span>, INI_DEFAULT_FORMAT, NULL, ini_listener, NULL)) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><p>In order to set the value to be assigned to implicit keys, please use the <code><a class="el" href="confini_8c.html#a23c849084899c22818465bc624a42a90" title="Sets the valued used for implicit keys. ">ini_set_implicit_value()</a></code> function. A <em>zero-length <code>TRUE</code>-boolean</em> is usually a good choice:</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">void ini_set_implicit_value (</span></div><div class="line"><span class="comment">    char * implicit_value,</span></div><div class="line"><span class="comment">    size_t implicit_v_len</span></div><div class="line"><span class="comment">);</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">*/</span></div><div class="line"></div><div class="line"><a class="code" href="confini_8c.html#a23c849084899c22818465bc624a42a90">ini_set_implicit_value</a>(<span class="stringliteral">&quot;YES&quot;</span>, 0);</div></div><!-- fragment --><p>Alternatively, instead of <code><a class="el" href="confini_8c.html#a23c849084899c22818465bc624a42a90" title="Sets the valued used for implicit keys. ">ini_set_implicit_value()</a></code> you can manually define at the beginning of your code the two global variables <code><a class="el" href="confini_8h.html#af8b0049b3a18c7704ad503ed6ad21927" title="Value to be dispatched in case of implicit keys (default value: NULL) ">INI_IMPLICIT_VALUE</a></code> and <code><a class="el" href="confini_8h.html#aa961b2edbb807839bbae5016301daf94" title="Length of the value dispatched in case of implicit keys – it can be set to any unsigned number...">INI_IMPLICIT_V_LEN</a></code>, which will be retrieved by <b>libconfini</b>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">char</span> *INI_IMPLICIT_VALUE = <span class="stringliteral">&quot;YES&quot;</span>;</div><div class="line"><span class="keywordtype">size_t</span> INI_IMPLICIT_V_LEN = 3;</div></div><!-- fragment --><p>If not defined elsewhere, these variables are respectively <code>NULL</code> and <code>0</code> by default.</p>
<p>After having set the value to be assigned to implicit key elements, it is possible to test whether a dispatched key is implicit or not by comparing the address of its <code>value</code> property with the global variable <code><a class="el" href="confini_8h.html#af8b0049b3a18c7704ad503ed6ad21927" title="Value to be dispatched in case of implicit keys (default value: NULL) ">INI_IMPLICIT_VALUE</a></code>:</p>
<div class="fragment"><div class="line"><span class="comment">/* examples/topics/ini_set_implicit_value.c */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define NO 0</span></div><div class="line"><span class="preprocessor">#define YES 1</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch, <span class="keywordtype">void</span> *v_null) {</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a> == INI_IMPLICIT_VALUE) {</div><div class="line"></div><div class="line">    printf(</div><div class="line">      <span class="stringliteral">&quot;\nDATA: %s\nVALUE: %s\n(This is an implicit key element)\n&quot;</span>,</div><div class="line">      dispatch-&gt;<a class="code" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">data</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a></div><div class="line">    );</div><div class="line"></div><div class="line">  } <span class="keywordflow">else</span> {</div><div class="line"></div><div class="line">    printf(<span class="stringliteral">&quot;\nDATA: %s\nVALUE: %s\n&quot;</span>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">data</a>, dispatch-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>);</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  <a class="code" href="structIniFormat.html">IniFormat</a> my_format;</div><div class="line"></div><div class="line">  <a class="code" href="confini_8c.html#a23c849084899c22818465bc624a42a90">ini_set_implicit_value</a>(<span class="stringliteral">&quot;[implicit default value]&quot;</span>, 0);</div><div class="line"></div><div class="line">  <span class="comment">/* Without setting this, implicit keys will be anyway considered empty: */</span></div><div class="line">  my_format.<a class="code" href="structIniFormat.html#ae5722efd535f1d27c624a927eea622c3">implicit_is_not_empty</a> = YES;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946">load_ini_path</a>(<span class="stringliteral">&quot;example.conf&quot;</span>, my_format, NULL, ini_listener, NULL)) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h2>SIZE OF THE DISPATCHED DATA</h2>
<p>Within an INI file it is granted that if one sums together all the <code>(dispatch-&gt;d_len + 1)</code> and all the <code>(dispatch-&gt;v_len &gt; 0 ? dispatch-&gt;v_len + 1 : 0)</code> received, the result will always be less-than or equal-to <code>(statistics-&gt;bytes + 1)</code> (where <code>+ 1</code> represents the NUL terminators). <b>If one adds to this also all the <code>dispatch-&gt;at_len</code> properties, or if the <code>dispatch-&gt;v_len</code> properties of implicit keys are non-zero, the sum may exceed it.</b> This can be relevant or irrelevant depending on your code.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">struct </span>size_check {</div><div class="line">  <span class="keywordtype">size_t</span> bytes, buff_lengths;</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_init (<a class="code" href="structIniStatistics.html">IniStatistics</a> *stats, <span class="keywordtype">void</span> *v_check_struct) {</div><div class="line"></div><div class="line">  ((<span class="keyword">struct </span>size_check *) v_check_struct)-&gt;bytes = stats-&gt;<a class="code" href="structIniStatistics.html#ab5911ee36bf6c20d6e9107c769945ffd">bytes</a>;</div><div class="line">  ((<span class="keyword">struct </span>size_check *) v_check_struct)-&gt;buff_lengths = 0;</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> ini_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *<span class="keyword">this</span>, <span class="keywordtype">void</span> *v_check_struct) {</div><div class="line"></div><div class="line">  ((<span class="keyword">struct </span>size_check *) v_check_struct)-&gt;buff_lengths += this-&gt;d_len + 1 + (this-&gt;v_len ? this-&gt;v_len + 1 : 0);</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  <span class="keyword">struct </span>size_check check;</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946">load_ini_path</a>(<span class="stringliteral">&quot;my_file.ini&quot;</span>, INI_DEFAULT_FORMAT, ini_init, ini_listener, &amp;check)) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  printf(</div><div class="line"></div><div class="line">    <span class="stringliteral">&quot;The file is %d bytes large.\n\nThe sum of the lengths of all &quot;</span></div><div class="line">    <span class="stringliteral">&quot;IniDispatch::data buffers plus the lengths of all non-empty &quot;</span></div><div class="line">    <span class="stringliteral">&quot;IniDispatch::value buffers is %d.\n&quot;</span>,</div><div class="line"></div><div class="line">    check.bytes, check.buff_lengths</div><div class="line"></div><div class="line">  );</div><div class="line"></div><div class="line">  <span class="comment">/* `INI_IMPLICIT_V_LEN` is 0 and is not even used, so this cannot happen: */</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (check.buff_lengths &gt; check.bytes) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;The end is near!&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h2>THE <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) – sizeof(IniFormat) should...">IniFormat</a></code> BITFIELD</h2>
<p>For a correct use of this library it is fundamental to understand the <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) – sizeof(IniFormat) should...">IniFormat</a></code> bitfield. <b>libconfini</b> has been born as a general INI parser, with the main purpose of <em>being able to understand INI files written by other programs</em> (see README), therefore some flexibility was required.</p>
<p>When an INI file is parsed it is parsed according to a format. The <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) – sizeof(IniFormat) should...">IniFormat</a></code> bitfield is a description of such format.</p>
<p>Each format can be represented also as a univocal 24-bit unsigned integer. In order to convert an <code><a class="el" href="structIniFormat.html" title="24-bit bitfield representing a unique format of an INI file (INI dialect) – sizeof(IniFormat) should...">IniFormat</a></code> to an unsigned integer and vice versa please see <code><a class="el" href="confini_8c.html#a9a64f92daee918044788b1d221c68631" title="Converts an IniFormat into an IniFormatId. ">ini_format_get_id()</a></code>, <code><a class="el" href="confini_8c.html#a70efd63125e671c52dc998341b4609db" title="Sets all the values of an IniFormat by reading them from an IniFormatId. ">ini_format_set_to_id()</a></code> and <code><a class="el" href="confini_8h.html#aa9513767c9138bc9067a182f6ef3e965" title="24-bit bitmask representing the format of an INI file ">IniFormatId</a></code>.</p>
<h3>THE MODEL FORMAT</h3>
<p>A model format named <code><a class="el" href="confini_8h.html#aafa50d590c715f37b74fa5938a35a56f" title="A model format. ">INI_DEFAULT_FORMAT</a></code> is available.</p>
<div class="fragment"><div class="line"><a class="code" href="structIniFormat.html">IniFormat</a> my_format;</div><div class="line"></div><div class="line">my_format = <a class="code" href="confini_8h.html#aafa50d590c715f37b74fa5938a35a56f">INI_DEFAULT_FORMAT</a>;</div></div><!-- fragment --><p>The code above corresponds to:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define NO 0</span></div><div class="line"><span class="preprocessor">#define YES 1</span></div><div class="line"></div><div class="line"><a class="code" href="structIniFormat.html">IniFormat</a> my_format;</div><div class="line"></div><div class="line">my_format.<a class="code" href="structIniFormat.html#a6d9981301f5a16d73e2c38cb80f7f962">delimiter_symbol</a> = <a class="code" href="confini_8h.html#ad342637c37d95454c9392a8cc73bced8a4f659344801c97d2fe59fd49bea2351f">INI_EQUALS</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a90f42c0052d9a45ad137f2f5517fbb3c">semicolon</a> = <a class="code" href="confini_8h.html#a397bfc55d3cf3e2ecd6b044e4d168796a01dfea6f7d0d7c409086448bf31d5218">INI_PARSE_COMMENT</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a8bcb597ed6feba60112a8467bdb4bfd7">hash</a> = <a class="code" href="confini_8h.html#a397bfc55d3cf3e2ecd6b044e4d168796a01dfea6f7d0d7c409086448bf31d5218">INI_PARSE_COMMENT</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a5bdf0e00657ad5521a027e454ec2298e">multiline_entries</a> = <a class="code" href="confini_8h.html#ac670c2fdf19ae6eee3de83dd183ae55fa17e1a311cef9d9ea4175de00a8e5f5f2">INI_EVERYTHING_MULTILINE</a>;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a50f562eda0d26ed7e0d3c57afeb46d2d">case_sensitive</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a491e94bda3f8545471a86f0845c92474">no_spaces_in_names</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a2fe0e57e8a802f828bc12a6462438e38">no_single_quotes</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#aa6e8b4274f3da1468a1806398b504d64">no_double_quotes</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#ae5722efd535f1d27c624a927eea622c3">implicit_is_not_empty</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#af411935de86436fb9555ee57ba04960e">do_not_collapse_values</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#a40a08a472ae9053fbaf4e7042967503d">no_disabled_after_space</a> = NO;</div><div class="line">my_format.<a class="code" href="structIniFormat.html#ab5937aaf72b0ce5b62aece8d23ad7b82">disabled_can_be_implicit</a> = NO; </div></div><!-- fragment --><h2>THE <code><a class="el" href="structIniStatistics.html" title="Global statistics about an INI file. ">IniStatistics</a></code> AND <code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a></code> STRUCTURES</h2>
<p>When the functions <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> / <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> read an INI file, they dispatches the file content to the <code>f_foreach()</code> listener. Before the dispatching begins some statistics about the parsed file can be dispatched to the <code>f_init()</code> listener (if this is non-<code>NULL</code>).</p>
<p>The information passed to <code>f_init()</code> is passed through an <code><a class="el" href="structIniStatistics.html" title="Global statistics about an INI file. ">IniStatistics</a></code> structure, while the information passed to <code>f_foreach()</code> is passed through an <code><a class="el" href="structIniDispatch.html" title="Dispatch of a single INI member. ">IniDispatch</a></code> structure.</p>
<h2>FORMATTING THE VALUES</h2>
<p>Once your listener starts to receive the parsed data you may want to parse and better format the <code>value</code> part of key elements. The following functions may be useful for this purpose:</p>
<ul>
<li><code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a312803fa24be2d7f164f3041fbfa6865" title="Gets the length of an INI array. ">ini_array_get_length()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a74789309b1a9c5b8886484c2b4d3a381" title="Compresses the distribution of the data of an INI array by removing all the white spaces that sorroun...">ini_collapse_array()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a4d0619b3d26be629b76b9403cc5ff00e" title="Calls a custom function for each member of an INI array – useful for read-only (const) stringified a...">ini_array_foreach()</a></code></li>
<li><code><a class="el" href="confini_8c.html#acee3223f103e6264fd5e1a8bd4a7f7d7" title="Splits an INI array and calls a custom function for each member. ">ini_split_array()</a></code></li>
<li><code><a class="el" href="confini_8c.html#a2a8dcc3d8ff26554486691423cce4ea0" title="Checks whether a string matches exactly one of the booleans listed in the private constant _LIBCONFIN...">ini_get_bool()</a></code></li>
<li><code><a class="el" href="confini_8c.html#ad95262d09842c25e8bb610bf95c42cd3" title="Checks whether the first letter of a string matches the first letter of one of the booleans listed in...">ini_get_lazy_bool()</a></code></li>
</ul>
<p>Together with the functions listed above the following links are available, in case you don't want to include <code>&lt;stdlib.h&gt;</code> in your source:</p>
<ul>
<li><code><a class="el" href="confini_8c.html#adba0d5ee273d05ed845c66f01a621119" title="Link to atoi() ">ini_get_int()</a></code> = <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atoi"><code>atoi()</code></a></li>
<li><code><a class="el" href="confini_8c.html#ae334387b2202eca25e16fb92694d56ca" title="Link to atol() ">ini_get_lint()</a></code> = <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atol"><code>atol()</code></a></li>
<li><code><a class="el" href="confini_8c.html#a9562da3c55b51795bbcbb2b19d608907" title="Link to atoll() ">ini_get_llint()</a></code> = <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atoll"><code>atoll()</code></a></li>
<li><code><a class="el" href="confini_8c.html#a26dd8ef0bfb57aaedbeac8007fd1a03a" title="Link to atof() ">ini_get_float()</a></code> = <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atof"><code>atof()</code></a></li>
</ul>
<h2>FORMATTING THE KEY NAMES</h2>
<p>The function <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code> may be useful for key names enclosed within quotes.</p>
<h2>FORMATTING THE SECTION PATHS</h2>
<p>In order to retrieve the parts of a section path, the functions <code><a class="el" href="confini_8c.html#a312803fa24be2d7f164f3041fbfa6865" title="Gets the length of an INI array. ">ini_array_get_length()</a></code>, <code><a class="el" href="confini_8c.html#a4d0619b3d26be629b76b9403cc5ff00e" title="Calls a custom function for each member of an INI array – useful for read-only (const) stringified a...">ini_array_foreach()</a></code> and <code><a class="el" href="confini_8c.html#acee3223f103e6264fd5e1a8bd4a7f7d7" title="Splits an INI array and calls a custom function for each member. ">ini_split_array()</a></code> can be used with <code>'.'</code> as delimiter. Note that section paths dispatched by <b>libconfini</b> are <em>always</em> collapsed arrays, therefore calling the function <code><a class="el" href="confini_8c.html#a74789309b1a9c5b8886484c2b4d3a381" title="Compresses the distribution of the data of an INI array by removing all the white spaces that sorroun...">ini_collapse_array()</a></code> on them will have no effects.</p>
<p>It may be required that the function <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code> be applied to each part of a section path, depending on the content and the format of the INI file.</p>
<h2>THE FORMATTING FUNCTIONS</h2>
<p>The functions <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>, <code><a class="el" href="confini_8c.html#a74789309b1a9c5b8886484c2b4d3a381" title="Compresses the distribution of the data of an INI array by removing all the white spaces that sorroun...">ini_collapse_array()</a></code> and <code><a class="el" href="confini_8c.html#acee3223f103e6264fd5e1a8bd4a7f7d7" title="Splits an INI array and calls a custom function for each member. ">ini_split_array()</a></code> change the content of the given string. It is important to point out that the edit is always performed within the length of the buffer given.</p>
<p>The behavior of these functions depends on the format given. In particular, using <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code> as model one obtains the following scheme:</p>
<ol type="1">
<li>Condition: <code>!format.no_single_quotes &amp;&amp; !format.no_double_quotes &amp;&amp; format.multiline_entries != INI_NO_MULTILINE</code><br />
 ⇒ Escape sequences: <code>\\</code>, <code>\&quot;</code>, <code>\'</code><br />
 ⇒ Behavior of <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>: <code>\\</code>, <code>\'</code> and <code>\&quot;</code> will be unescaped, all unescaped single and double quotes will be removed,&#160;then the new length of the string will be returned.</li>
<li>Condition: <code>!format.no_single_quotes &amp;&amp; format.no_double_quotes &amp;&amp; format.multiline_entries != INI_NO_MULTILINE</code><br />
 ⇒ Escape sequences: <code>\\</code>, <code>\'</code><br />
 ⇒ Behavior of <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>: <code>\\</code> and <code>\'</code> will be unescaped, all unescaped single quotes will be removed,&#160;then the new length of the string will be returned.</li>
<li>Condition: <code>format.no_single_quotes &amp;&amp; !format.no_double_quotes &amp;&amp; format.multiline_entries != INI_NO_MULTILINE</code><br />
 ⇒ Escape sequences: <code>\\</code>, <code>\&quot;</code><br />
 ⇒ Behavior of <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>: <code>\\</code> and <code>\&quot;</code> will be unescaped, all unescaped double quotes will be removed,&#160;then the new length of the string will be returned.</li>
<li>Condition: <code>format.no_single_quotes &amp;&amp; format.no_double_quotes &amp;&amp; format.multiline_entries == INI_NO_MULTILINE</code><br />
 ⇒ Escape sequences: No escape sequences<br />
 ⇒ Behavior of <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>: No changes will be performed, only the length of the string will be counted and returned.</li>
</ol>
<h2>STRING COMPARISONS</h2>
<p>In order to perform comparisons between strings the function <code><a class="el" href="confini_8c.html#afc434b767b4ccd1d21366f8c45c022fa" title="Compares two simple strings and checks if they match. ">ini_string_match_ss()</a></code>, <code><a class="el" href="confini_8c.html#a5b11229fa691bdb7ab3ce94425ef3d28" title="Compares an INI string with a simple string and checks if they match according to a format...">ini_string_match_si()</a></code> and <code><a class="el" href="confini_8c.html#a8ae367e3837ca6b911777ef63c877d3d" title="Compares two INI strings and checks if they match according to a format. ">ini_string_match_ii()</a></code> are available. The function <code><a class="el" href="confini_8c.html#afc434b767b4ccd1d21366f8c45c022fa" title="Compares two simple strings and checks if they match. ">ini_string_match_ss()</a></code> compares two simple strings, the function <code><a class="el" href="confini_8c.html#a5b11229fa691bdb7ab3ce94425ef3d28" title="Compares an INI string with a simple string and checks if they match according to a format...">ini_string_match_si()</a></code> compares a simple string with an unparsed INI string, and the function <code><a class="el" href="confini_8c.html#a8ae367e3837ca6b911777ef63c877d3d" title="Compares two INI strings and checks if they match according to a format. ">ini_string_match_ii()</a></code> compares two unparsed INI strings. INI strings are the strings typically dispatched by <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> and <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code>, which may contain quotes and the three escaping sequences <code>\\</code>, <code>\'</code>, <code>\&quot;</code>. Simple strings are user-given strings or the result of <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>.</p>
<p>As a consequence, the functions <code><a class="el" href="confini_8c.html#a5b11229fa691bdb7ab3ce94425ef3d28" title="Compares an INI string with a simple string and checks if they match according to a format...">ini_string_match_si()</a></code>, <code><a class="el" href="confini_8c.html#a8ae367e3837ca6b911777ef63c877d3d" title="Compares two INI strings and checks if they match according to a format. ">ini_string_match_ii()</a></code> do not perform literal comparisons of equality between strings. For example, in the following (absurd) INI file the two keys <code>foo</code> and <code>hello</code> belong to the same section named <code>this is a double quotation mark: "!</code> (after parsed by <code><a class="el" href="confini_8c.html#ac55f3fab95f697ac5058533df100fc11" title="Unescapes \\, \&#39; and \&quot; and removes all unescaped quotes (if single/double quotes are considered meta...">ini_unquote()</a></code>).</p>
<div class="fragment"><div class="line">[this is a double quotation mark: \&quot;!]</div><div class="line"></div><div class="line">foo = bar</div><div class="line"></div><div class="line">[this is a double quotation mark: &#39;&quot;&#39;!]</div><div class="line"></div><div class="line">hello = world</div></div><!-- fragment --><p>Therefore...</p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span></div><div class="line">    string1[] = <span class="stringliteral">&quot;This is a double quotation mark: \\\&quot;!&quot;</span>,</div><div class="line">    string2[] = <span class="stringliteral">&quot;This is a double quotation mark: \&#39;\&quot;\&#39;!&quot;</span>;</div><div class="line"></div><div class="line">printf(<span class="stringliteral">&quot;%s\n&quot;</span>, <a class="code" href="confini_8c.html#a8ae367e3837ca6b911777ef63c877d3d">ini_string_match_ii</a>(string1, string2, my_format) ? <span class="stringliteral">&quot;They match&quot;</span> : <span class="stringliteral">&quot;They don&#39;t match&quot;</span>);   <span class="comment">// &quot;They match&quot;</span></div></div><!-- fragment --><p>The three functions <code><a class="el" href="confini_8c.html#afc434b767b4ccd1d21366f8c45c022fa" title="Compares two simple strings and checks if they match. ">ini_string_match_ss()</a></code>, <code><a class="el" href="confini_8c.html#a5b11229fa691bdb7ab3ce94425ef3d28" title="Compares an INI string with a simple string and checks if they match according to a format...">ini_string_match_si()</a></code>, <code><a class="el" href="confini_8c.html#a8ae367e3837ca6b911777ef63c877d3d" title="Compares two INI strings and checks if they match according to a format. ">ini_string_match_ii()</a></code> perform case-sensitive or case-insensitive comparisons depending on the format given. UTF-8 codepoints out of the ASCII range are always compared case-sensitive.</p>
<p>Remember that the multiline escaping sequence (<code>/\\(?:\n\r?|\r\n?)/</code>) is <b>not</b> considered as such in INI strings, since this is the only escaping sequence automatically unescaped by <b>libconfini</b> <em>before</em> each dispatch.</p>
<h2>CODE CONSIDERATIONS</h2>
<h3>RETURN VALUES</h3>
<p>The functions <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code>, <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code>, <code><a class="el" href="confini_8c.html#a4d0619b3d26be629b76b9403cc5ff00e" title="Calls a custom function for each member of an INI array – useful for read-only (const) stringified a...">ini_array_foreach()</a></code> and <code><a class="el" href="confini_8c.html#acee3223f103e6264fd5e1a8bd4a7f7d7" title="Splits an INI array and calls a custom function for each member. ">ini_split_array()</a></code> require some listeners defined by the user. Such listeners must return an <code>int</code> value. When this is non-zero the caller function is interrupted, its loop stopped, and a non-zero value is returned by the caller as well.</p>
<p>The functions <code><a class="el" href="confini_8c.html#a90987f4565566e21693b90239663618d" title="Parses an INI file and dispatches its content. ">load_ini_file()</a></code> and <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code> return a non-zero value also if the INI file, for any reason, has not been completely parsed (see <code>enum</code> <code><a class="el" href="confini_8h.html#ae6a17d09c16887dfd373eb0c05e4d325" title="Error codes – the actual values of each constant should be considered opaque. ">ConfiniErrorNo</a></code>). Therefore, in order to be able to distinguish between internal errors and user-generated interruptions the flag <code>CONFINI_ERROR</code> can be used.</p>
<p>For instance, in the following example the <code>f_foreach()</code> listener returns a non-zero value if a key named <code>password</code> with a value that equals <code>Hello world</code> is found. Hence, using the flag <code>CONFINI_ERROR</code>, the code below distinguishes a non-zero value generated by the listener from a non-zero value generated by a parsing error in <code><a class="el" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946" title="Parses an INI file and dispatches its content. ">load_ini_path()</a></code>'s return value.</p>
<div class="fragment"><div class="line"><span class="comment">/* examples/topics/ini_string_match_si.c */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> passfinder (<a class="code" href="structIniDispatch.html">IniDispatch</a> *disp, <span class="keywordtype">void</span> *v_membid) {</div><div class="line"></div><div class="line">  <span class="comment">/* Search for `password = &quot;Hello world&quot;` in the INI file */</span></div><div class="line">  <span class="keywordflow">if</span> (</div><div class="line">    <a class="code" href="confini_8c.html#a5b11229fa691bdb7ab3ce94425ef3d28">ini_string_match_si</a>(<span class="stringliteral">&quot;password&quot;</span>, disp-&gt;<a class="code" href="structIniDispatch.html#a3821b15b23e587eca172763dd4acd954">data</a>, disp-&gt;<a class="code" href="structIniDispatch.html#adfda221d4a9effcb4f3ee6a99c5f2de2">format</a>)</div><div class="line">    &amp;&amp; <a class="code" href="confini_8c.html#a5b11229fa691bdb7ab3ce94425ef3d28">ini_string_match_si</a>(<span class="stringliteral">&quot;Hello world&quot;</span>, disp-&gt;<a class="code" href="structIniDispatch.html#a8d7eb3387ff5ecb79900fae717234d16">value</a>, disp-&gt;<a class="code" href="structIniDispatch.html#adfda221d4a9effcb4f3ee6a99c5f2de2">format</a>)</div><div class="line">  ) {</div><div class="line"></div><div class="line">    *((<span class="keywordtype">size_t</span> *) v_membid) = disp-&gt;<a class="code" href="structIniDispatch.html#a795864cff55f67498aa22722c17fc6d2">dispatch_id</a>;</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line"></div><div class="line">  <span class="keywordtype">size_t</span> membid;</div><div class="line"></div><div class="line">  <span class="comment">/* Load INI file */</span></div><div class="line">  <span class="keywordtype">int</span> retval = <a class="code" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946">load_ini_path</a>(</div><div class="line">    <span class="stringliteral">&quot;example.conf&quot;</span>,</div><div class="line">    INI_DEFAULT_FORMAT,</div><div class="line">    NULL,</div><div class="line">    passfinder,</div><div class="line">    &amp;membid</div><div class="line">  );</div><div class="line"></div><div class="line">  <span class="comment">/* Check for errors */</span></div><div class="line">  <span class="keywordflow">if</span> (retval &amp; CONFINI_ERROR) {</div><div class="line"></div><div class="line">    fprintf(stderr, <span class="stringliteral">&quot;Sorry, something went wrong :-(\n&quot;</span>);</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line"></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">/* Check if `load_ini_path()` has been interrupted by `passfinder()` */</span></div><div class="line">  retval  ==  <a class="code" href="confini_8h.html#ae6a17d09c16887dfd373eb0c05e4d325ac1b16fd34464a73e424e31212d7ae8ab">CONFINI_EFEINTR</a> ?</div><div class="line">                printf(<span class="stringliteral">&quot;We found it! It&#39;s the INI element number #%d!\n&quot;</span>, membid)</div><div class="line">              :</div><div class="line">                printf(<span class="stringliteral">&quot;We didn&#39;t find it :-(\n&quot;</span>);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line"></div><div class="line">}</div></div><!-- fragment --><h3>OTHER GLOBAL SETTINGS</h3>
<p>Besides the two global variables <code><a class="el" href="confini_8h.html#af8b0049b3a18c7704ad503ed6ad21927" title="Value to be dispatched in case of implicit keys (default value: NULL) ">INI_IMPLICIT_VALUE</a></code> and <code><a class="el" href="confini_8h.html#aa961b2edbb807839bbae5016301daf94" title="Length of the value dispatched in case of implicit keys – it can be set to any unsigned number...">INI_IMPLICIT_V_LEN</a></code>, a third variable named <code><a class="el" href="confini_8h.html#a881b84c6c3d2c1e65978ae4ae79ae798" title="If set to any non-zero value key and section names in case-insensitive INI formats will be dispatched...">INI_INSENSITIVE_LOWERCASE</a></code> tells <b>libconfini</b> whether to dispatch key names and section paths lower-case or not in case-insensitive INI files.</p>
<p>As with the other global variables, the variable <code><a class="el" href="confini_8h.html#a881b84c6c3d2c1e65978ae4ae79ae798" title="If set to any non-zero value key and section names in case-insensitive INI formats will be dispatched...">INI_INSENSITIVE_LOWERCASE</a></code> can be declared at the beginning of your code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#define FALSE 0</span></div><div class="line"><span class="preprocessor">#define TRUE 1</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"></div><div class="line"><span class="keywordtype">short</span> <span class="keywordtype">int</span> INI_INSENSITIVE_LOWERCASE = FALSE;</div></div><!-- fragment --><p>Alternatively, it can be set through the function <code><a class="el" href="confini_8c.html#a67793c7a03728319d5ca76c1703e773a" title="Sets the value of the global variable INI_INSENSITIVE_LOWERCASE ">ini_dispatch_case_insensitive_lowercase()</a></code> without being explicitly declared.</p>
<p>When the variable <code><a class="el" href="confini_8h.html#a881b84c6c3d2c1e65978ae4ae79ae798" title="If set to any non-zero value key and section names in case-insensitive INI formats will be dispatched...">INI_INSENSITIVE_LOWERCASE</a></code> is set to any non-zero value, <b>libconfini</b> will always convert all ASCII letters to lowercase (except within values) &ndash; <em>even when these are enclosed within quotes</em> &ndash; but will <b>not</b> convert UTF-8 code points to lowercase (for instance, <code>Ā</code> will not be rendered as <code>ā</code>, but will be rather rendered verbatim). <em>In general it is a good practice to use UTF-8 within values, but to use ASCII only within keys names and sections names.</em></p>
<h3>THREAD SAFETY</h3>
<p>Depending on the format of the INI file, <b>libconfini</b> may use up to three global variables (<code><a class="el" href="confini_8h.html#af8b0049b3a18c7704ad503ed6ad21927" title="Value to be dispatched in case of implicit keys (default value: NULL) ">INI_IMPLICIT_VALUE</a></code>, <code><a class="el" href="confini_8h.html#aa961b2edbb807839bbae5016301daf94" title="Length of the value dispatched in case of implicit keys – it can be set to any unsigned number...">INI_IMPLICIT_V_LEN</a></code> and <code><a class="el" href="confini_8h.html#a881b84c6c3d2c1e65978ae4ae79ae798" title="If set to any non-zero value key and section names in case-insensitive INI formats will be dispatched...">INI_INSENSITIVE_LOWERCASE</a></code>). In order to be thread-safe these three variables (if needed) must be defined only once (either directly, or through their modifier functions <code><a class="el" href="confini_8c.html#a23c849084899c22818465bc624a42a90" title="Sets the valued used for implicit keys. ">ini_set_implicit_value()</a></code> and <code><a class="el" href="confini_8c.html#a67793c7a03728319d5ca76c1703e773a" title="Sets the value of the global variable INI_INSENSITIVE_LOWERCASE ">ini_dispatch_case_insensitive_lowercase()</a></code>), or otherwise a mutex logic must be introduced. It is indeed very important that these variables are not changed during a parsing process.</p>
<p>Apart from the three variables above, each parsing allocates and frees its own memory, therefore the library must be considered thread-safe.</p>
<h3>ERROR EXCEPTIONS</h3>
<p>The philosophy of <b>libconfini</b> is to parse as much as possible without generating error exceptions. No parsing errors are returned once an INI file has been correctly allocated into the stack, with the exception of the <em>out-of-range</em> error <code>CONFINI_EFEOOR</code> (see <code>enum</code> <code><a class="el" href="confini_8h.html#ae6a17d09c16887dfd373eb0c05e4d325" title="Error codes – the actual values of each constant should be considered opaque. ">ConfiniErrorNo</a></code>), whose meaning is that the loop is for unknown reasons longer than expected &ndash; this error is possibly generated by the presence of bugs in the library's code and should never be returned (please <a href="https://github.com/madmurphy/libconfini/issues">contact me</a> if this happens).</p>
<p>When an INI node is wrongly written in respect to the format given, it is dispatched verbatim as an <code>INI_UNKNOWN</code> node &ndash; see <code>enum</code> <code><a class="el" href="confini_8h.html#a4e394db479f56eaa830ade09c907461b" title="INI nodes types. ">IniNodeType</a></code>.</p>
<p>In order to avoid error exceptions, strings containing an unterminated quote will always be treated as if they had a virtual quote as their last + 1 character. For example,</p>
<div class="fragment"><div class="line">foo = &quot;bar</div></div><!-- fragment --><p>will always determine the same behavior as if it were</p>
<div class="fragment"><div class="line">foo = &quot;bar&quot;</div></div><!-- fragment --><h3>PERFORMANCE</h3>
<p>The algorithms used by <b>libconfini</b> stand in a delicate equilibrium between flexibility, speed and code readability, with flexibility as primary target. Performance can vary with the format used to parse an INI file, but in most of the cases is not a concern.</p>
<p>One can measure the performance of the library by doing something like:</p>
<div class="fragment"><div class="line"><span class="comment">/* Please create an INI file large enough and call it &quot;big_ini_file.conf&quot; */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="confini_8h.html">confini.h</a>&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> get_ini_size (<a class="code" href="structIniStatistics.html">IniStatistics</a> *statistics, <span class="keywordtype">void</span> *v_bytes) {</div><div class="line">  *((<span class="keywordtype">size_t</span> *) v_bytes) = statistics-&gt;<a class="code" href="structIniStatistics.html#ab5911ee36bf6c20d6e9107c769945ffd">bytes</a>;</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> empty_listener (<a class="code" href="structIniDispatch.html">IniDispatch</a> *dispatch, <span class="keywordtype">void</span> *v_bytes) {</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main () {</div><div class="line">  <span class="keywordtype">size_t</span> bytes;</div><div class="line">  <span class="keywordtype">double</span> seconds;</div><div class="line">  clock_t start, end;</div><div class="line">  <a class="code" href="structIniFormat.html">IniFormat</a> my_format = <a class="code" href="confini_8h.html#aafa50d590c715f37b74fa5938a35a56f">INI_DEFAULT_FORMAT</a>;</div><div class="line">  start = clock();</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="confini_8c.html#ac7b1bb4df0f7297f659135f0f4b39946">load_ini_path</a>(<span class="stringliteral">&quot;big_ini_file.conf&quot;</span>, my_format, get_ini_size, empty_listener, &amp;bytes)) {</div><div class="line">    <span class="keywordflow">return</span> 1;</div><div class="line">  }</div><div class="line">  end = clock();</div><div class="line">  seconds = (end - start) / (<span class="keywordtype">double</span>) CLOCKS_PER_SEC;</div><div class="line">  printf(</div><div class="line">    <span class="stringliteral">&quot;%d bytes parsed in %f seconds.\n&quot;</span></div><div class="line">    <span class="stringliteral">&quot;Number of bytes parsed per second: %f\n&quot;</span>,</div><div class="line">    bytes, seconds, bytes / seconds</div><div class="line">  );</div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p>By changing the properties of the variable <code>my_format</code> on the code above you may obtain different results.</p>
<p>On my old laptop <b>libconfini</b> seems to parse around 20 MB per second using the model format <code>INI_DEFAULT_FORMAT</code>. Whether this is enough for you or not, that depends on your needs.</p>
<div class="fragment"><div class="line">54692353 bytes parsed in 2.692092 seconds.</div><div class="line">Number of bytes parsed per second: 20315930.139089</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
</body>
</html>
