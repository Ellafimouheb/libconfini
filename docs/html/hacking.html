<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libconfini: Hacking libconfini</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libconfini
   </div>
   <div id="projectbrief">Yet another INI parser</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Hacking libconfini </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Code snippets and replacements</p>
<p>The following guide illustrates possible changes to the library's code to meet particular particular needs. For any questions, please <a href="https://github.com/madmurphy/libconfini/issues">drop a message</a>.</p>
<h1>Parsing numbers without the C Standard Library</h1>
<p>As explained in the <a class="el" href="libconfini.html">Library Functions Manual</a> (see section <em>ยง Compiling for extreme platforms</em>), compiling <b>libconfini</b> without the C Standard Library requires getting rid of the functions <code><a class="el" href="confini_8h.html#adba0d5ee273d05ed845c66f01a621119" title="Link to atoi()">ini_get_int()</a></code>, <code><a class="el" href="confini_8h.html#ae334387b2202eca25e16fb92694d56ca" title="Link to atol()">ini_get_lint()</a></code>, <code><a class="el" href="confini_8h.html#a9562da3c55b51795bbcbb2b19d608907" title="Link to atoll()">ini_get_llint()</a></code> and <code>ini_get_float()</code> &ndash; as these are nothing else but links to the standard functions <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atoi"><code>atoi()</code></a>, <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atol"><code>atol()</code></a>, <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atoll"><code>atoll()</code></a> and <a href="http://www.gnu.org/software/libc/manual/html_node/Parsing-of-Integers.html#index-atof"><code>atof()</code></a>.</p>
<p>Instead of just removing the function pointers above, however, it is also possible to provide novel functions implemented from scratch for parsing numbers. This guide shows possible re-implementations of these functions. Feel free to make the changes that you wish.</p>
<p>In order to proceed, replace in <code><a class="el" href="confini_8h.html" title="libconfini header">src/confini.h</a></code> the function pointers declared immediately after the comment <code>/* PUBLIC LINKS */</code> with the following function headers:</p>
<div class="fragment"><div class="line"><span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="confini_8h.html#adba0d5ee273d05ed845c66f01a621119">ini_get_int</a> (</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="confini_8h.html#ae334387b2202eca25e16fb92694d56ca">ini_get_lint</a> (</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="confini_8h.html#a9562da3c55b51795bbcbb2b19d608907">ini_get_llint</a> (</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">float</span> ini_get_float (</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string</div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">double</span> <a class="code" href="confini_8h.html#ab0330bc2629009b1848293abc0de5a6c">ini_get_double</a> (</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string</div>
<div class="line">);</div>
</div><!-- fragment --><p>Then replace in <code><a class="el" href="confini_8c.html" title="libconfini functions">src/confini.c</a></code> (at the end of the file) the same aforementioned pointers with the code below. Note that the C language does not possess a templating mechanism, so we need to rely on a macro for not repeating five times the same function body.</p>
<p><em><b>Note:</b> The code below is released under the terms of the GPL license, version 3 or any later version.</em></p>
<div class="fragment"><div class="line"><span class="preprocessor">#define __PP_IIF__(CONDITION, ...) __PP_EVALCAT__(__PP_UCAT__(__COND, CONDITION), __)(__VA_ARGS__, , )</span></div>
<div class="line"><span class="preprocessor">#define __COND_0__(IF_TRUE, IF_FALSE, ...) IF_FALSE</span></div>
<div class="line"><span class="preprocessor">#define __COND_1__(IF_TRUE, ...) IF_TRUE</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define _LIBCONFINI_RADIX_POINT_ &#39;.&#39;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">Mask `abcd` (6 bits used):</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">    FLAG_1      Continue the loop</span></div>
<div class="line"><span class="comment">    FLAG_2      The numerical part has been found</span></div>
<div class="line"><span class="comment">    FLAG_4      This is the sign</span></div>
<div class="line"><span class="comment">    FLAG_8      Radix point has not been encountered yet</span></div>
<div class="line"><span class="comment">    FLAG_16     This is a digit</span></div>
<div class="line"><span class="comment">    FLAG_32     The number is negative</span></div>
<div class="line"><span class="comment"> </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"><span class="preprocessor">#define _LIBCONFINI_STR2NUM_FNBODY_(IS_RATIONAL, DATA_TYPE, STR) \</span></div>
<div class="line"><span class="preprocessor">    register uint8_t abcd = 9; \</span></div>
<div class="line"><span class="preprocessor">    register DATA_TYPE retval = 0; \</span></div>
<div class="line"><span class="preprocessor">    __PP_IIF__(IS_RATIONAL, \</span></div>
<div class="line"><span class="preprocessor">        DATA_TYPE fact = 1; \</span></div>
<div class="line"><span class="preprocessor">    ) \</span></div>
<div class="line"><span class="preprocessor">    for (register size_t idx = 0; abcd &amp; 1; idx++) { \</span></div>
<div class="line"><span class="preprocessor">        abcd    =   STR[idx] == &#39;-&#39; ? \</span></div>
<div class="line"><span class="preprocessor">                        (abcd &amp; 6 ? abcd &amp; 14 : (abcd &amp; 47) | 36) \</span></div>
<div class="line"><span class="preprocessor">                    : STR[idx] == &#39;+&#39; ? \</span></div>
<div class="line"><span class="preprocessor">                        (abcd &amp; 6 ? abcd &amp; 14 : (abcd &amp; 15) | 4) \</span></div>
<div class="line"><span class="preprocessor">                    : STR[idx] &gt; 47 &amp;&amp; STR[idx] &lt; 58 ? \</span></div>
<div class="line"><span class="preprocessor">                        abcd | 18 \</span></div>
<div class="line"><span class="preprocessor">                    __PP_IIF__(IS_RATIONAL, \</span></div>
<div class="line"><span class="preprocessor">                    : (abcd &amp; 8) &amp;&amp; STR[idx] == _LIBCONFINI_RADIX_POINT_ ? \</span></div>
<div class="line"><span class="preprocessor">                        (abcd &amp; 39) | 2 \</span></div>
<div class="line"><span class="preprocessor">                    ) \</span></div>
<div class="line"><span class="preprocessor">                    : !(abcd &amp; 2) &amp;&amp; is_some_space(STR[idx], _LIBCONFINI_WITH_EOL_) ? \</span></div>
<div class="line"><span class="preprocessor">                        (abcd &amp; 47) | 1 \</span></div>
<div class="line"><span class="preprocessor">                    : \</span></div>
<div class="line"><span class="preprocessor">                        abcd &amp; 46; \</span></div>
<div class="line"><span class="preprocessor">        if (abcd &amp; 16) { \</span></div>
<div class="line"><span class="preprocessor">            retval =    __PP_IIF__(IS_RATIONAL, \</span></div>
<div class="line"><span class="preprocessor">                        abcd &amp; 8 ? \</span></div>
<div class="line"><span class="preprocessor">                            STR[idx] - 48 + retval * 10 \</span></div>
<div class="line"><span class="preprocessor">                        : \</span></div>
<div class="line"><span class="preprocessor">                            (STR[idx] - 48) / (fact *= 10) + retval, \</span></div>
<div class="line"><span class="preprocessor">                        retval * 10 + STR[idx] - 48 \</span></div>
<div class="line"><span class="preprocessor">                        ); \</span></div>
<div class="line"><span class="preprocessor">        } \</span></div>
<div class="line"><span class="preprocessor">    } \</span></div>
<div class="line"><span class="preprocessor">    return abcd &amp; 32 ? -retval : retval;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define __INTEGER_DATA_TYPE__ 0</span></div>
<div class="line"><span class="preprocessor">#define __FLOAT_DATA_TYPE__ 1</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code" href="confini_8h.html#adba0d5ee273d05ed845c66f01a621119">ini_get_int</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string) {</div>
<div class="line">    _LIBCONFINI_STR2NUM_FNBODY_(__INTEGER_DATA_TYPE__, <span class="keywordtype">int</span>, ini_string);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="confini_8h.html#ae334387b2202eca25e16fb92694d56ca">ini_get_lint</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string) {</div>
<div class="line">    _LIBCONFINI_STR2NUM_FNBODY_(__INTEGER_DATA_TYPE__, <span class="keywordtype">long</span> <span class="keywordtype">int</span>, ini_string);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> <a class="code" href="confini_8h.html#a9562da3c55b51795bbcbb2b19d608907">ini_get_llint</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string) {</div>
<div class="line">    _LIBCONFINI_STR2NUM_FNBODY_(__INTEGER_DATA_TYPE__, <span class="keywordtype">long</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span>, ini_string);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">float</span> ini_get_float (<span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string) {</div>
<div class="line">    _LIBCONFINI_STR2NUM_FNBODY_(__FLOAT_DATA_TYPE__, <span class="keywordtype">float</span>, ini_string);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">double</span> <a class="code" href="confini_8h.html#ab0330bc2629009b1848293abc0de5a6c">ini_get_double</a> (<span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> ini_string) {</div>
<div class="line">    _LIBCONFINI_STR2NUM_FNBODY_(__FLOAT_DATA_TYPE__, <span class="keywordtype">double</span>, ini_string);</div>
<div class="line">}</div>
</div><!-- fragment --><h1>Using a non-standard I/O API</h1>
<p>Currently only two I/O standards are supported: the C Standard and POSIX Standard. If you think that <b>libconfini</b> should also support a I/O API provided by a non-standard header (such as <code>fsio.h</code>, <code>mem-ffs.h</code>, <code>efs.h</code> or <code>ff.h</code>), please do not hesitate to <a href="https://github.com/madmurphy/libconfini/issues">propose it</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aconfini_8h_html_ae334387b2202eca25e16fb92694d56ca"><div class="ttname"><a href="confini_8h.html#ae334387b2202eca25e16fb92694d56ca">ini_get_lint</a></div><div class="ttdeci">long int(*const ini_get_lint)(const char *ini_string)</div><div class="ttdoc">Link to atol()</div><div class="ttdef"><b>Definition:</b> confini.c:4875</div></div>
<div class="ttc" id="aconfini_8h_html_a9562da3c55b51795bbcbb2b19d608907"><div class="ttname"><a href="confini_8h.html#a9562da3c55b51795bbcbb2b19d608907">ini_get_llint</a></div><div class="ttdeci">long long int(*const ini_get_llint)(const char *ini_string)</div><div class="ttdoc">Link to atoll()</div><div class="ttdef"><b>Definition:</b> confini.c:4877</div></div>
<div class="ttc" id="aconfini_8h_html_ab0330bc2629009b1848293abc0de5a6c"><div class="ttname"><a href="confini_8h.html#ab0330bc2629009b1848293abc0de5a6c">ini_get_double</a></div><div class="ttdeci">double(*const ini_get_double)(const char *ini_string)</div><div class="ttdoc">Link to atof()</div><div class="ttdef"><b>Definition:</b> confini.c:4879</div></div>
<div class="ttc" id="aconfini_8h_html_adba0d5ee273d05ed845c66f01a621119"><div class="ttname"><a href="confini_8h.html#adba0d5ee273d05ed845c66f01a621119">ini_get_int</a></div><div class="ttdeci">int(*const ini_get_int)(const char *ini_string)</div><div class="ttdoc">Link to atoi()</div><div class="ttdef"><b>Definition:</b> confini.c:4873</div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
